CREATE DATABASE STOREPHONEDOCTOR;

USE STOREPHONEDOCTOR

CREATE TABLE CLIENTES(
    EMAIL_CL            VARCHAR(50)         PRIMARY KEY,
    CONTRASENA          VARCHAR(50)         NOT NULL DEFAULT="PASSWORD",
    NOMBRE_CL           VARCHAR(30)         NOT NULL,
    AP_CL               VARCHAR(30)         NOT NULL,
    AM_CL               VARCHAR(30)         NOT NULL,
    TEL_CL              VARCHAR(15)         NOT NULL,
    MUN_CL              VARCHAR(20)         NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'REGISTRO DE CLIENTES FRECUENTES';

CREATE TABLE USUARIOS(
    USERNAME_US         VARCHAR(20)         PRIMARY KEY,
    EMAIL_US            VARCHAR(50)         NOT NULL UNIQUE,
    CONTRASENA          VARCHAR(50)         NOT NULL DEFAULT="PASSWORD"
    NOMBRE_US           VARCHAR(30)         NOT NULL,
    AP_US               VARCHAR(30)         NOT NULL,
    AM_US               VARCHAR(30)         NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'REGISTRO DE USUARIOS DEL SISTEMA';

CREATE TABLE PRODUCTOS(
    CODIGO_P            VARCHAR(13)         PRIMARY KEY,
    NOMBRE_P            VARCHAR(50)         NOT NULL,
    CATEGORIA_P         VARCHAR(30)         NOT NULL,
    CANTIDAD_P          INT                 NOT NULL,
    PRECIO_VENTA_P      FLOAT               NOT NULL,
    PRECIO_COMPRA_P     FLOAT               NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'REGISTRO DEL INVENTARIO';

CREATE TABLE SERVICIOS(
    FOLIO_S             VARCHAR(10)         PRIMARY KEY,
    USERNAME_US         VARCHAR(20)         NOT NULL,
    EMAIL_CL            VARCHAR(50)         NOT NULL,
    FECHALLEGADA_S      TIMESTAMP           DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FECHASALIDA_S       DATE,
    NOMBRECLIENTE_S     VARCHAR(60)         NOT NULL,
    TELEFONOCLIENTE_S   VARCHAR(20)         NOT NULL,
    DESCRIPCION_S       VARCHAR(250)        NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'BITACORA DE SERVICIOS';

ALTER TABLE SERVICIOS
ADD CONSTRAINT FK_US
FOREIGN KEY(USERNAME_US) REFERENCES USUARIOS(USERNAME_US);

ALTER TABLE SERVICIOS
ADD CONSTRAINT FK_CL
FOREIGN KEY(EMAIL_CL) REFERENCES CLIENTES(EMAIL_CL);

CREATE TABLE VENTAS(
    FOLIO_V             VARCHAR(10)         PRIMARY KEY,
    USERNAME_US         VARCHAR(20)         NOT NULL,
    EMAIL_CL            VARCHAR(50)         NOT NULL,
    FECHA_V             TIMESTAMP           DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CANTIDADPROD_V      INT                 NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'BITACORA DE VENTAS';

ALTER TABLE VENTAS
ADD CONSTRAINT FK_CL_V
FOREIGN KEY(EMAIL_CL) REFERENCES CLIENTES(EMAIL_CL);
ALTER TABLE VENTAS
ADD CONSTRAINT FK_US_V
FOREIGN KEY(USERNAME_US) REFERENCES USUARIOS(USERNAME_US);

CREATE TABLE VENTAS_PRODUCTO(
    ID_VP               VARCHAR(5)          PRIMARY KEY,
    FOLIO_V             VARCHAR(10)         NOT NULL,
    CODIGO_P            VARCHAR(13)         NOT NULL)
    ENGINE=MYISAM CHARSET=LATIN1 
    COMMENT'PRODUCTOS VENDIDOS';

ALTER TABLE VENTAS_PRODUCTO
ADD CONSTRAINT FK_V
FOREIGN KEY(FOLIO_V) REFERENCES VENTAS(FOLIO_V);

ALTER TABLE VENTAS_PRODUCTO
ADD CONSTRAINT FK_P
FOREIGN KEY(CODIGO_P) REFERENCES PRODUCTOS(CODIGO_P);

INSERT INTO VENTAS_PRODUCTO(ID_VP,FOLIO_V,CODIGO_P) VALUES
('159DF','1597530286','ASD123FGH456J');

    INSERT INTO CLIENTES(USERNAME_CL,CONTRASENA_CL,EMAIL_CL,NOMBRE_CL,AP_CL,AM_CL,TEL_CL,MUN_CL) VALUES
    ('Paty_Lu','Paydequeso','may.patrics@gmail.com','Mayra Patricia','Perez','Martinez','7751326996','Tulancingo'),
    ('Dani_02','Password','danypink06@hotmail.com','Daniela','Rubiales','Marquez','7711548264','Huasca'),
    ('Norberto_L','Holakase','luisgearsofwar@hotmail.com','Luis Norberto','Paloma','Rodriguez','7751685496','Tulancingo');

INSERT INTO USUARIOS(USERNAME_US,EMAIL_US,NOMBRE_US,AP_US,AM_US) VALUES
('Admin','root@storephone.doctor.com','Norberto','Paloma','Rodriguez');

INSERT INTO PRODUCTOS(CODIGO_P,NOMBRE_P,CATEGORIA_P,CANTIDAD_P,PRECIO_VENTA_P,PRECIO_COMPRA_P) VALUES
('ASD123FGH456J','MICA DE CRISTAL','MICAS',15,50.0,20.0);

INSERT INTO VENTAS(FOLIO_V,USERNAME_US,EMAIL_CL,FECHA_V,CANTIDADPROD_V) VALUES
('1597530286','Admin','danypink06@hotmail.com',DEFAULT,5);

INSERT INTO SERVICIOS(FOLIO_S,USERNAME_US,USERNAME_CL,FECHALLEGADA_S,NOMBRECLIENTE_S,TELEFONOCLIENTE_S,DESCRIPCION_S) VALUES
('1025SDFE51','Admin','Paty_Lu',DEFAULT,'Daniela Rubiales','7751256584','Reinstalacion de sistema operativo');

CREATE VIEW IMPORTE_DE_V AS
SELECT PRECIO_VENTA_P * CANTIDADPROD_V AS IMPORTE_V FROM PRODUCTOS, VENTAS;

CREATE VIEW INVENTARIO_NO_ADMN AS
SELECT NOMBRE_P, CANTIDAD_P, PRECIO_VENTA_P 
FROM PRODUCTOS;

CREATE VIEW SERVICIOS_NO_ADM AS
SELECT FOLIO_S,FECHALLEGADA_S,NOMBRECLIENTE_S,TELEFONOCLIENTE_S,DESCRIPCION_S FROM SERVICIOS;

CREATE VIEW SERVICIOS_NO_ADM_DOS AS
SELECT FOLIO_S,FECHALLEGADA_S,NOMBRE_CL FROM SERVICIOS
INNER JOIN CLIENTES WHERE SERVICIOS.EMAIL_CL=CLIENTES.EMAIL_CL;
